name: 🚀 Buat Video (Manual)

on:
  # Ini adalah "Frontend" Anda:
  # Membuat tombol "Run workflow" di tab Actions
  workflow_dispatch:
    inputs:
      data_berita:
        description: 'Tempel (paste) seluruh naskah data_berita.txt di sini'
        required: true
        type: string # 'string' memberi kotak teks besar

jobs:
  build_video:
    runs-on: ubuntu-latest

    steps:
      # 1. Mengunduh kode, font, dan file data Anda ke server
      - name: 1. Checkout Repository
        uses: actions/checkout@v4

      # 2. Ini adalah "Backend" Anda:
      #    Mengambil teks dari input dan membuat file data_berita.txt
      - name: 2. Buat data_berita.txt dari Input Form
        run: echo "${{ inputs.data_berita }}" > data_berita.txt

      # 3. Menyiapkan lingkungan Python 3.11
      - name: 3. Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      # 4. Install library sistem untuk FONT
      - name: 4. Install System Dependencies (For Fonts)
        run: |
          sudo apt-get update
          sudo apt-get install -y libfreetype6-dev

      # 5. Install library Python dari requirements.txt
      - name: 5. Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 6. Menjalankan "Mesin" Python Anda
      - name: 6. Run Video Generation Script
        run: |
          echo "🚀 Mulai menjalankan 'videogen_beta.py'..."
          python videogen_beta.py
          echo "✅ Skrip selesai dijalankan."

      # 7. Memeriksa apakah file video benar-benar dibuat
      - name: 7. Verify Video Output
        run: |
          if ! ls output_video_*.mp4 1> /dev/null 2>&1; then
            echo "❌ GAGAL: Tidak ada file 'output_video_*.mp4' yang ditemukan!"
            exit 1
          fi
          echo "👍 File video ditemukan:"
          ls -lh output_video_*.mp4

      # 8. Mengunggah file video untuk di-download
      - name: 8. Upload Video Artifacts
        if: success() 
        uses: actions/upload-artifact@v4
        with:
          name: generated-videos
          path: output_video_*.mp4
          retention-days: 7
